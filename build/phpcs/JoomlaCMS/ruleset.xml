<?xml version="1.0"?>
<ruleset name="JoomlaCMS">

    <arg name="report" value="full"/>
    <arg name="tab-width" value="4"/>
    <arg name="encoding" value="utf-8"/>
    <arg value="sp"/>

    <!-- Exclude folders not containing production code -->
    <exclude-pattern type="relative">build/*</exclude-pattern>
    <exclude-pattern type="relative">docs/*</exclude-pattern>
    <exclude-pattern type="relative">cache/*</exclude-pattern>
    <exclude-pattern type="relative">tmp/*</exclude-pattern>
    <exclude-pattern type="relative">logs/*</exclude-pattern>
    <exclude-pattern>*/lib/*</exclude-pattern>
    <exclude-pattern>*/tmpl/*</exclude-pattern>
    <exclude-pattern>*/layouts/*</exclude-pattern>

    <!-- Exclude 3rd party libraries and Framework code. -->
    <exclude-pattern type="relative">libraries/compat/password/*</exclude-pattern>
    <exclude-pattern type="relative">libraries/fof/*</exclude-pattern>
    <exclude-pattern type="relative">libraries/idna_convert/*</exclude-pattern>
    <exclude-pattern type="relative">libraries/php-encryption/*</exclude-pattern>
    <exclude-pattern type="relative">libraries/phputf8/*</exclude-pattern>
    <exclude-pattern type="relative">libraries/simplepie/*</exclude-pattern>
    <exclude-pattern type="relative">libraries/phpass/*</exclude-pattern>
    <exclude-pattern type="relative">libraries/vendor/*</exclude-pattern>
    <exclude-pattern type="relative">*/vendor/*</exclude-pattern>

    <!-- Exclude the restore_finalisation until we can deal with nested class definitions -->
    <exclude-pattern type="relative">administrator/components/com_joomlaupdate/restore_finalisation.php</exclude-pattern>
    <exclude-pattern type="relative">administrator/components/com_joomlaupdate/restore.php</exclude-pattern>
    <exclude-pattern type="relative">configuration.php</exclude-pattern>
    <exclude-pattern type="relative">installation/template/index.php</exclude-pattern>
    <exclude-pattern type="relative">plugins/captcha/recaptcha/recaptchalib.php</exclude-pattern>

    <!-- Exclude some test related files that don't actually include PHP code -->
    <exclude-pattern type="relative">tests/unit/suites/libraries/joomla/model/stubs/barbaz.php</exclude-pattern>
    <exclude-pattern type="relative">tests/unit/suites/libraries/joomla/view/layouts1/fringe/division.php</exclude-pattern>
    <exclude-pattern type="relative">tests/unit/suites/libraries/joomla/view/layouts1/olivia.php</exclude-pattern>
    <exclude-pattern type="relative">tests/unit/suites/libraries/joomla/view/layouts1/peter.php</exclude-pattern>
    <exclude-pattern type="relative">tests/unit/suites/libraries/joomla/view/layouts2/fauxlivia.php</exclude-pattern>
    <exclude-pattern type="relative">tests/unit/suites/libraries/joomla/view/layouts2/olivia.php</exclude-pattern>
    <exclude-pattern type="relative">tests/unit/suites/libraries/legacy/controller/stubs/component1/controller.json.php</exclude-pattern>
    <exclude-pattern type="relative">tests/unit/suites/libraries/legacy/controller/stubs/component2/controller.php</exclude-pattern>

    <exclude-pattern type="relative">tests/*</exclude-pattern>

    <!-- Exclude the RoboFile.php -->
    <exclude-pattern type="relative">RoboFile.php</exclude-pattern>

    <rule ref="Generic.Files.EndFileNewline">
        <!-- These exceptions are temporary for now, possibly permanent -->
        <exclude-pattern type="relative">*/tmpl/*</exclude-pattern>
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
    </rule>
    <rule ref="Generic.Files.LineLength">
        <!-- These exceptions are temporary for now, possibly permanent -->
        <exclude-pattern type="relative">*/tmpl/*</exclude-pattern>
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
        <exclude-pattern type="relative">tests/*</exclude-pattern>
    </rule>
    <rule ref="Generic.Formatting.DisallowMultipleStatements">
        <exclude-pattern type="relative">*/tmpl/*</exclude-pattern>
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
    </rule>
    <rule ref="Generic.WhiteSpace.DisallowSpaceIndent">
        <!-- These exceptions are temporary for now -->
        <exclude-pattern type="relative">administrator/components/*</exclude-pattern>
        <exclude-pattern type="relative">components/*</exclude-pattern>
        <exclude-pattern type="relative">libraries/cms/*</exclude-pattern>
    </rule>

    <rule ref="PEAR.Functions.ValidDefaultValue">
        <!-- These exceptions are temporary for now -->
        <exclude-pattern type="relative">administrator/components/*</exclude-pattern>
        <exclude-pattern type="relative">components/*</exclude-pattern>
        <exclude-pattern type="relative">modules/mod_articles_category/helper.php</exclude-pattern>
        <exclude-pattern type="relative">libraries/cms/*</exclude-pattern>
    </rule>
    <rule ref="PEAR.NamingConventions.ValidClassName">
        <!-- These exceptions are temporary for now -->
        <exclude-pattern type="relative">installation/controller/install/database_*</exclude-pattern>
    </rule>

    <rule ref="Squiz.WhiteSpace.ScopeClosingBrace">
        <!-- These exceptions are temporary -->
        <exclude-pattern type="relative">*/tmpl/*</exclude-pattern>
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
    </rule>

    <!-- Include some additional sniffs from the Zend standard -->
    <rule ref="Zend.Files.ClosingTag">
        <exclude-pattern type="relative">*/tmpl/*</exclude-pattern>
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
    </rule>

    <rule ref="Joomla.Commenting.FileComment">
        <exclude-pattern type="relative">tests/*</exclude-pattern>
    </rule>
    <rule ref="Joomla.Commenting.FunctionComment">
        <!-- We only want this for libraries, language and cli for now -->
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
        <exclude-pattern type="relative">*/tests/*</exclude-pattern>
    </rule>
    <rule ref="Joomla.Commenting.SingleComment">
        <!-- We don't want this in mixed html/php views for now -->
        <exclude-pattern type="relative">*/tmpl/*</exclude-pattern>
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
    </rule>
    <rule ref="Joomla.Commenting.ClassComment">
        <exclude-pattern type="relative">tests/*</exclude-pattern>
    </rule>
    <rule ref="Joomla.ControlStructures.ControlSignature">
        <!-- These exceptions are permanent -->
        <exclude-pattern type="relative">*/tmpl/*</exclude-pattern>
        <exclude-pattern type="relative">templates/*</exclude-pattern>
        <exclude-pattern type="relative">layouts/*</exclude-pattern>
    </rule>

    <rule ref="Joomla">
        <exclude name="Joomla.NamingConventions.ValidVariableName.ClassVarHasUnderscore"/>
        <exclude name="Joomla.NamingConventions.ValidFunctionName.FunctionNoCapital"/>
        <exclude name="Joomla.NamingConventions.ValidVariableName.MemberNotCamelCaps"/>
        <exclude name="Joomla.NamingConventions.ValidFunctionName.MethodUnderscore"/>
        <exclude name="Joomla.NamingConventions.ValidVariableName.NotCamelCaps"/>
        <exclude name="Joomla.NamingConventions.ValidFunctionName.ScopeNotCamelCaps"/>
        <exclude name="Generic.Files.LineEndings.InvalidEOLChar"/>
    </rule>
</ruleset>
